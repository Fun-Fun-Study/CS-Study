# 정규화 정의

> 관계형 데이터베이스의 설계에서 중복을 최소화하게 데이터를 구조화하는 프로세스를 정규화(Normalization)이라고 한다.

---

# 정규화의 목적

- 데이터의 중복을 배제하여 이상 현상을 막는다
- 테이블에 중복된 종속성을 분할한다
- 데이터베이스의 구조 확장 시 변경을 줄인다
- 데이터 삽입 시 기존 데이터를 변경을 줄인다

## 이상 현상

- 일부 속성이나 데이터가 중복되어 데이터를 조작할 때 불일치가 발생하는 현상을 말한다.
  ### 삽입 이상
  - 데이터를 삽입할 때 의도와 다른 값도 함께 삽입되는 경우
  ### 삭제 이상
  - 데이터를 삭제할 때 의도하지 않은 값도 함께 삭제되는 경우
  ### 갱신 이상
  - 중복되는 속성으로 인해 일부 속성만 값이 갱신되어 불일치가 발생하는 경우

## 함수적 종속

- 특정한 속성에 의해 다른 속성이 정해지는 관계를 함수적 종속이라고 한다.
- X에 의해 Y가 결정되는 경우 **X -> Y** 라고 표현하며 X는 결정자, Y는 종속자라고 부른다.
- 함수적 종속에는 **완전 함수적 종속**과 **부분 함수적 종속**, **이행적 함수 종속**의 3종류가 있다.
  ### 완전 함수적 종속
  - 기본키에 의해 다른 속성이 결정되는 함수 종속
  ### 부분 함수적 종속
  - 기본키를 구성하는 속성 중 일부 또는 기본키가 아닌 속성에 종속되는 경우
  ### 이행적 함수 종속
  - X -> Y이고 Y -> Z일 때 X -> Z가 성립되는 경우

---

# 정규화 과정

## 1NF

- **도메인이 원자값**인 정규형
- 예시) 수강테이블

  ![](https://blog.kakaocdn.net/dn/NRCAQ/btrj110vGrs/n1XpWYrc5RdtwYRpeuwHQK/img.png)

- 도메인 원자값: 각 튜플이 하나의 컬럼에 대해 하나의 값만을 가져야한다.

  ![](https://blog.kakaocdn.net/dn/VJ4EU/btrj2ABojKV/9t35vgqac4GMBVYYBIIKs0/img.png)

## 2NF

- 1정규형을 만족하면서 **부분적 함수종속이 없는** 정규형
- 예시) 성적테이블

  ![](https://blog.kakaocdn.net/dn/pwqKp/btrj2WEouSq/rHLj2INEMyM1PkzYkWATK1/img.png)

- 과목 컬럼에 의해 지도교수가 결정되는 부분적 함수 종속이 존재한다.

  ![](https://blog.kakaocdn.net/dn/skXwR/btrj0U2B6V9/s4xUYsd8DBZwLLew4gJ0Ik/img.png)

## 3NF

- 2정규형을 만족하며 기본키를 제외한 속성들 간의 **이행 종속성이 없는** 정규형
- 예시)

  ![](https://blog.kakaocdn.net/dn/xUsSs/btrj4sJJchb/jZhQDFOYYSNkqM75cG87w0/img.png)

- ID에 의해 등급이 결정되고, 등급에 의해 할인율이 결정되는 이행 종속성이 존재한다.

  ![](https://blog.kakaocdn.net/dn/dYnxPO/btrP8O3VPDg/DfyMkh8K5mnKFBp35BOJYk/img.png)

## BCNF

- 3정규형을 강화한 정규형
- 3정규형을 만족하며 **모든 결정자가 후보키 집합에 속하는** 정규형
- 예시)

  ![](https://blog.kakaocdn.net/dn/tpoYs/btrj0WF7W9S/Lzze4LuSZFnkaOxBFinSlK/img.png)

- 학생번호와 과목이 기본키인데 지도교수에 의해 과목이 결정되는 종속성이 존재한다.
  => 후보키 집합에 속하지 않는 결정자가 존재한다.

  ![](https://blog.kakaocdn.net/dn/bDpCpQ/btrP9j99LpS/4SlIuGmJLNSCsoWvLARRtK/img.png)

- 4정규형부터는 정규화의 단점이 나타날 가능성이 높아지기 때문에 보통은 BCNF까지 진행한다.

## 4NF

- BCNF를 만족하며 **다치 종속이 없는** 정규형
  ### 다치 종속
  - 다치 종속성: A -> B일때 하나의 A에 대해 여러 개의 B값이 존재하는 경우. A ->> B로 표기한다
  - 2개 이상의 컬럼이 하나의 컬럼에 다치 종속인 경우 4NF를 만족하지 않는다고 한다.
- 예시)

  ![](https://blog.kakaocdn.net/dn/v82sZ/btrQbrziqqF/Ub60jtgosxZ2WQDVQ5POYK/img.png)

  ![](https://blog.kakaocdn.net/dn/z0rJH/btrP9joI2p8/vLN068YGJsOIZUmsICJiVK/img.png)

- 학생번호 하나에 여러개의 과목, 여러개의 취미가 존재한다.

  ![](https://blog.kakaocdn.net/dn/7XKzy/btrP7OiNpBW/OGPWeVPSx7KnMvpS4pNOu1/img.png)

## 5NF

- 4NF를 만족하며 **조인 종속이 없는** 정규형

  ### 조인종속

  - 다치 종속의 일반화한 형태
  - 하나의 릴레이션을 2개로 분해했다가 조인했을 때 손실없이 원래의 릴레이션이 되는 경우를 말한다.

    ![](https://blog.kakaocdn.net/dn/9gog7/btrP6gUdKXn/jTHi5a8esN1fCrOYLRIGk1/img.png)

  - 일반적으로 현실의 데이터베이스는 5NF를 사용하지 않는다.

---

# 반정규화

- 데이터베이스의 성능 향상을 위해서 정규화 단계를 일부러 어기는 작업
- 데이터의 중복을 허용하고 조회 시 조인 연산을 줄여 성능을 향상시킨다.
- 반정규화를 하게 되면 데이터베이스의 조회 속도는 향상되지만 데이터 모델의 유연성은 낮아진다.

## 정규화의 문제점

- 정규화가 잘된 데이터베이스에서 데이터를 조회하는 경우 조인 연산이 자주 발생하게 된다.
- 조인 연산이 자주 발생하는 경우 CPU와 메모리를 많이 사용하게 되는 단점이 있다.

## 반정규화 절차

1. 대상 조사 및 검토

   데이터 처리 범위, 통계성 등을 확인해서 반정규화 대상을 조사한다.

2. 다른 방법 검토

   반정규화 수행 전에 다른 개선 방법이 있는지 검토한다.

   예시) 클러스터링, 뷰, 인덱스 튜닝, 응용 프로그램, 파티션 등

3. 반정규화 수행

   테이블, 속성, 관계 등을 반정규화 한다.

## 반정규화 기법

### 테이블 반정규화

- 테이블 병합
  - 1대1, 1대M 관계를 통합하거나 슈퍼/서브 관계를 통합하여 성능을 향상
- 테이블 분할
  - 수직 분할: 자주 사용되는 컬럼끼리 묶어 조회에서 불필요한 컬럼들이 함께 조회 되지 않도록 함.디스크 I/O를 분산하여 성능을 향상. 사전에 트랜잭션의 처리 유형에 대한 파악 필요
  - 수평 분할: 자주 조회되는 로우들을 분리하여 데이터 접근의 효율성을 높임. 대체로 연도, 달 등의 단위로 분리하는 경우가 많다
- 테이블 추가
  - 중복테이블 추가: 다른 업무영역에서 같은 데이터를 처리하는 경우 또는 다른 서버에서 작업하는 경우에 동일한 테이블을 중복으로 만들어 내부에서 조회하도록하여 성능 향상
  - 통계테이블 추가: 집계함수의 결과를 미리 수행하여 저장해두어 성능 향상

### 속성 반정규화

- 중복 속성 추가
  - 조인 연산을 줄이기 위해 테이블에 중복되는 속성을 추가

### 관계 반정규화

- 중복관계 추가
  - 여러 경로로 조인하여 계산된 결과를 만들 수 있지만 그때의 부하가 클 때, 해당 결과가 나올 수 있도록 관계를 미리 추가하여 성능을 향상

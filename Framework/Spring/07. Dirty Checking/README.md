# Dirty Checking

## Dirty Checking이란

> Dirty란 상태의 변화가 생긴 정도<br>Dirty Checking은 **상태 변경 검사**

### Dirty Checking 의 동작원리

- JPA에서는 **_트랜잭션이 끝나는 시점_**에 변화가 있는 모든 엔티티 객체를 데이터베이스에 자동으로 반영

  > 변화가 있는 엔티티란, 최초 조회 상태를 기준

- JPA에서는 엔티티를 조회하면 해당 엔티티의 조회 상태를 스냅샷을 만든다. (최초 조회 상태)

- 트랜잭션이 끝나는 시점에 이 스냅샷과 비교해서 변경이 있으면 Update query를발생

- Dirty Checking대상은 <span style="color: skyblue">**영속성 컨텍스트가 관리하는 엔티티**</span>에만 적용

- 준영속, 비영속 상태의 엔티티는 Dirty Checking대상에 포함되지 않는다.
  - Detech된 엔티티 - 준영속 (더이상 영속성 컨텍스트에게 관리되지 않고 분리됐지만 식별자는 존재함)
  - DB에 반영되기 전 처음 생성된 엔티티 - 비영속 (영속성 컨텍스트와 관련이 없는 상태)

### Dirty Cheking Update

> Dirty Checking으로 생성되는 update뭐리는 기본적으로 모든 필드를 update

#### JPA는 전체 필드를 업데이트하는 방식을 기본값으로 사용

- 생성된 쿼리가 같아 부트 실행 시점에 미리 만들어 재사용 가능

- 데이터베이스 입장에서도 쿼리 재사용 (동일한 쿼리를 받으면 캐시에서 꺼내 쓸 수 있음)

- 필드가 많아질 경우 전체 필드 update 쿼리가 부담이 됨

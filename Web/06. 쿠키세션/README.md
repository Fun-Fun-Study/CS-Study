# 쿠키 & 세션

### 쿠키 & 세션을 왜 사용?

#### 보통 웹 환경에서는 클라이언트 서버가 HTTP 프로토콜을 이용해 통신하는데, 이 HTTP 프로토콜의 특징이자 약점을 보완하기 위해 사용

1. Connectionless (비연결성)
   - 클라이언트가 서버에 요청을 했을 때, 그 요청에 맞는 응답을 보낸 후 `연결을 끊는 처리 방식`
2. Stateless (무상태)
   - 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며, `상태 정보는 유지하지 않는` 특성 (다음의 통신에서 이전 데이터를 유지하지 않음. 하지만 실제로는 데이터 유지가 필요한 경우가 많음)

#### 때문에 이 Stateful 해야하는 경우를 대처하기 위해 쿠키와 세션을 사용

<br>

## 쿠키

### 쿠키란?

> 💡 사이트가 사용하고 있는 서버에서 클라이언트(로컬)에 저장하는 키와 값이 들어있는 작은 데이터 파일

### 쿠키의 특징

- 이름, 값, 만료일(저장기간), 경로 정보로 구성
- 클라이언트에 총 n개의 쿠키를 저장 (브라우저마다 상이)
- 도메인 당 총 m개의 쿠키를 저장
- 하나의 쿠키는 4096byte까지 저장 가능

### 쿠키의 종류

- 세션 쿠키(Session Cookie / Temporary Cookie)
  - 브라우저가 쿠키를 메모리에 저장
  - 브라우저의 세션 동안만 유지되는 쿠키
  - 브라우저가 종료되는 즉시 쿠키도 소멸
  - 쿠키를 생성할 때 날짜를 지정하지 않으면 세션 쿠키
- 영구 쿠키(Persistent Cookie)
  - 브라우저가 쿠키를 디스크에 저장
  - 브라우저가 종료되어도 쿠키의 값은 유지
  - 브라우저를 다시 실행하면 디스크에 저장된 쿠키를 복구
  - 만료 날짜가 지나면 자동으로 삭제

### 쿠키의 동작 순서

1. 클라이언트가 페이지를 요청

2. 웹 서버는 쿠키를 생성
3. 생성한 쿠키에 정보를 담아 HTTP응답을 보낼 때, 같이 클라이언트에게 전달
4. 넘겨받은 쿠키는 로컬 PC에 저장했다가, 이후 서버에 다시 요청할 때 요청과 함께 쿠키를 전송
5. 동일 사이트 재방문 시 로컬 PC에 해당 쿠키가 있는 경우, 요청과 함께 쿠키를 전송

<br>

## 세션

### 세션이란?

> 💡 일정 시간(방문자가 웹 서버에 접속해 있는 상태) 동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술

### 세션의 특징

- 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장
- 로컬PC가 아닌 웹 서버에 저장되는 쿠키
- 브라우저를 닫거나, 서버에서 세션을 삭제할 경우만 삭제가 되므로, 쿠키보다 비교적 보안이 좋음
- 저장 데이터에 제한이 없음 (서버 용량이 허용하는 선에서)
- 각 클라이언트에 고유 Session ID를 부여. Session ID로 클라이언트를 구분해 각 요구에 맞는 서비스를 제공

### 세션의 동작 순서

1. 클라이언트에가 페이지에 요청
2. 서버는 접근한 클라이언트의 Request-Header 필드인 Cookie를 확인하여, 클라이언트가 해당 Session ID를 보냈는지 확인
3. Session ID가 존재하지 않는다면 서버는 Session ID를 생성해 클라이언트에게 넘겨줌
4. 클라이언트는 서버로부터 받은 Session ID를 쿠키에 저장
5. 클라이언트는 서버에 요청 시 이 쿠키의 Session ID 값을 같이 서버에 전달
6. 서버는 전달받은 Session ID로 session에 있는 클라이언트 정보를 가지고 요청을 처리 후 응답

<br>

## 쿠키와 세션의 차이

### 쿠키

- **서버의 자원을 전혀 사용하지 않음**
- 로컬에 저장되기 떄문에 변질되거나, request에서 snipping 당할 우려가 있어 `보안에 취약`
- 파일로 저장되기 때문에 `브라우저를 종료해도 정보가 유지`, 또한 만료기간을 따로 저장해 쿠키를 삭제할 때까지 유지도 가능
- 쿠키에 정보가 있기 때문에 서버 요청 시 `속도가 빠름`

### 세션

- **서버의 자원을 사용**
- 쿠키를 이용해서 Session ID만 저장하고, 그것으로 서버에서 구분하여 처리하기 때문에 `보안적인 측면에서 우수`
- 만료기간을 정할 수 있지만, `브라우저가 종료되면 만료기간에 상관없이 삭제`
- 서버에 정보가 있기 때문에 처리가 요구되어 `비교적 속도가 느림`

# 인터럽트

## 인터럽트(Interrupt)란?

> 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치에 **예외상황이 발생하여 처리가 필요한 경우** 이를 처리할 수 있도록 하는 것을 말한다.

## 인터럽트의 종류

### 외부 인터럽트

입출력 장치, 타이밍 장치, 전원 등의 외부적인 용인에 의해 발생하는 인터럽트

- 전원 이상 인터럽트: 정전이나 전원이 이상이 있는 경우
- 입출력 인터럽트: CPU등의 기능적인 동작 오류가 발생한 경우
- 입출력 인터럽트(I/O Interrupt): 입출력의 종료 등의 이유로 CPU의 수행을 요청하는 인터럽트

### 내부 인터럽트

잘못된 명령이나 데이터를 사용할 때 발생하는 인터럽트

- 0으로 나누는 경우
- 오버플로우 또는 언더플로우가 발생한 경우
- 프로그램 상의 오류
- 프로그램에서 함수 등 명령어를 잘못 사용한 경우
- CPU가 인스트럭션을 수행하는 종중에 일어나는 인터럽트

## 인터럽트 과정

1. 인터럽트 요청
2. 프로그램 실행 중단
3. 현재의 프로그램 상태 보존: PCB(Process Control Block), PC(Program Counter) 등
4. 인터럽트 처리 루틴 실행: 인터럽트를 요청한 장치를 식별한다.
5. 인터럽트 서비스 루틴 실행: 인터럽트 원인을 파악하고 실질적인 작업을 수행한다.
6. 상태복구: 인터럽트 발생시 저장해둔 PC(Program Counter)를 다시 복구한다.
7. 중단된 프로그램 실행 재개: PC의 값을 이용하여 이전에 수행중이던 프로그램을 재개한다.

## 인터럽트 서비스 루틴

> 인터럽트에 대응하는 특정 기능을 처리하는 기계어 코드 루틴을 말한다.

- 인터럽트 핸들러라고도 한다.

## 인터럽트 우선순위

여러 장치에서 인터럽트가 동시에 발생하거나 인터럽트 서비스 루틴 수행 중 인터럽트가 발생했을 경우 우선순위를 따져서 처리한다.

일반적으로 하드웨어 인터럽트가 소프트웨어 인터럽트보다 우선 순위가 높고 내부 인터럽트보다 외부 인터럽트가 순위가 높다.

### 소프트웨어적인 방법(Polling)

- 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트를 찾고 이에 해당하는 인터럽트 서비스 루틴을 수행한다.
- 우선순위 변경이 쉽다.
- 많은 인터럽트가 있을 경우 하드웨어적인 방법에 비해서 우선순위 판단 속도가 느리다.
- 회로가 간단하고 융통성이 있으며, 별도의 하드웨어가 필요 없다.

### 하드웨어적인 방법(Vectored Interrupt)

- 인터럽트를 요청할 수 있는 장치와 CPU사이에 장치번호를 식별할 수 있는 버스를 직렬/병렬로 연결한다.
- 인터럽트 벡터는 인터럽트를 발생한 장치가 분기할 곳에 대한 정보이다.
- 소프트웨어적인 방법에 비해 비경제적이다.
- 회로가 복잡하고 융통성이 없으나, 별도의 소프트웨어가 필요없이 하드웨어로 처리되므로 속도가 빠르다.

하드웨어적인 방법은 아래 2가지로 나뉜다.

- Daisy Chain

  - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결한다.
  - 우선순위가 높은 장치를 상위에 두고 우선순위 차례대로 배치한다.

- 병렬(Parallel) 우선순위 부여 방식
  - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결한다.
  - 각 장치별 우선순위를 판별하기 위한 Mask register에 bit를 설정한다.
  - Mask register상 우선순위가 높은 서비스 루틴 수행 중 우선순위가 낮은 bit들을 비활성화 시킬 수 있다.
  - 반대로 우선순위가 높은 인터럽트는 낮은 인터럽트 수행 중에도 우선 처리된다.
